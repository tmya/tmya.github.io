<!doctype html>
<html lang="ja" itemscope itemtype="http://schema.org/Person">
<head>
            <meta charset="utf-8">
        <!-- Site Meta Data -->
        <title>ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="Akio Tomita">

        <link rel="shortcut icon" href="">

        <!-- schema.org -->
        <meta itemprop="name" content="tmya note">
        <meta itemprop="image" content="">
        <meta itemprop="description" content="">

        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700' rel='stylesheet' type='text/css'>
        <!-- Style Meta Data -->
        <link rel="stylesheet" href="./theme/css/style.css" type="text/css"/>
        <link rel="stylesheet" href="./theme/css/pygments.css" type="text/css"/>

        <!-- Feed Meta Data -->

        <!-- Twitter Feed -->
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="">
        <meta name="twitter:image" content="">

    <meta name="twitter:creator" content="">
    <meta name="twitter:url" content="./miracle-linux-tips-minecraft-server-conoha-vps.html">
    <meta name="twitter:title" content="tmya note ~ ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版">
    <meta name="twitter:description" content="この記事は5/25開催の MIRACLE LINUX Meetup!! でライブデモを行う際の資料です。マインクラフトサーバを建てる時の参考になれば幸いで …">

    <!-- Facebook Meta Data -->
    <meta property="og:title" content="tmya note ~ ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版"/>
    <meta property="og:description" content="この記事は5/25開催の MIRACLE LINUX Meetup!! でライブデモを行う際の資料です。マインクラフトサーバを建てる時の参考になれば幸いで …"/>
    <meta property="og:image" content=""/>
</head>

<body>
<!-- Sidebar -->
<aside>
    <!--<center><a href="."><img id="avatar" src=""></a></center>-->
    <h1>tmya note</h1>
        <p>Something else</p>
    <br>


    <nav class="nav">
        <ul class="list-bare">

                <li><a class="nav__link" href="https://tmya.github.io">Blog</a></li>

                <li><a class="nav__link" href="./pages/about.html">About</a></li>

        </ul>
    </nav>

    <p class="social">
                <a href="https://github.com/tmya" target="_blank"><img
                        src="./theme/images/icons/github.png"></a>
                <a href="https://twitter.com/tmyanote" target="_blank"><img
                        src="./theme/images/icons/twitter.png"></a>
    </p>

        <h2>Categories</h2>
        <ul class="navbar">
                <li><a
                        href="./category/blog.html">blog</a></li>
                <li class="active"><a
                        href="./category/miracle-linux.html">MIRACLE LINUX</a></li>
                <li><a
                        href="./category/miracle-linux-84.html">MIRACLE LINUX 8.4</a></li>
                <li><a
                        href="./category/miracle-linux-miracle-linux-9.html">"MIRACLE LINUX", "MIRACLE LINUX 9"</a></li>
                <li><a
                        href="./category/p-tips.html">p-tips</a></li>
        </ul>


</aside>

<!-- Content -->
<article>
    <section id="content">
        <article>
            <h2 class="post_title post_detail"><a href="./miracle-linux-tips-minecraft-server-conoha-vps.html" rel="bookmark"
                                                  title="Permalink to ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版">ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版</a></h2>
            <div class="entry-content blog-post">
                <p><strong>この記事は5/25開催の MIRACLE LINUX Meetup!! でライブデモを行う際の資料です。マインクラフトサーバを建てる時の参考になれば幸いです。イベントページについては<a href="https://miraclelinux.connpass.com/event/245908/">こちら</a>をご覧ください。</strong></p>
<p>前提として、ConoHaの契約を行いコントロールパネルにログインができるようになっていることを想定しています。</p>
<h4>設定の流れ</h4>
<ol>
<li>ConoHaのVPSでサーバを追加</li>
<li>コンソールを開く</li>
<li>JAVAのインストール</li>
<li>マインクラフトサーバの本体をダウンロード</li>
<li>サーバの初期設定</li>
<li>ファイヤウォールの設定</li>
<li>サーバの起動</li>
<li>ゲームの起動と接続</li>
<li>（おまけ）提供マップデータのマルチサーバへの適用</li>
</ol>
<h3>手順1 - ConoHaのVPSでサーバを追加</h3>
<p>ConoHaのコントロールパネルにログイン後、<code>VPS</code>タブの<code>サーバー追加</code>をクリックし、下記の設定でサーバーを追加します。</p>
<ul>
<li>リージョン : <code>東京</code></li>
<li>サービス : <code>VPS</code><ul>
<li>Minecraftというタブがあり簡単設定もできますが、今回のライブデモではOS標準の状態からサーバーを用意するため選びません。</li>
</ul>
</li>
<li>VPS割引きっぷ : <code>利用しない</code><ul>
<li>今回はデモでサーバーを長期利用しないので利用しません。ずっと使うのであれば安く利用できる可能性があるので検討しても良いと思います。</li>
</ul>
</li>
<li>(月額料金書いてある部分) : <code>4GB 3,608円/月</code><ul>
<li>今回はこのプランを利用します。6人ぐらいまでであればこのプランで良いようです。</li>
</ul>
</li>
<li>イメージタイプ : <code>OSタブ</code>の<code>MIRACLE LINUX 8.4 (64bit)</code></li>
<li>root パスワード : 表記通りに9〜70文字で半角英数記号の組み合わせでお好みのものを。</li>
<li>ネームタグ : そのままでも構いませんし、<code>Minecraft-server</code>などわかりやすく名づけても良いと思います。</li>
</ul>
<p><code>オプションを見る</code>をクリックして展開します。</p>
<ul>
<li>自動バックアップ : <code>無効</code></li>
<li>追加ディスク : <code>使用しない</code></li>
<li>接続許可ポート IPv4 : <code>指定ポートのみ許可</code> → <code>Postgre/SQL(5432)</code>のみチェック</li>
<li>接続許可ポート IPv6 : <code>全て拒否</code></li>
<li>SSH Key : <code>使用しない</code></li>
<li>スタートアップスクリプト : <code>使用しない</code></li>
</ul>
<p>画面右側の<code>追加</code>をクリックしてください。少し待つと画面が遷移して指定したネームタグのサーバがサーバーリスト画面に表示されます。追加したサーバーのステータスが<code>構築中</code>になり、30秒前後待つと<code>起動中</code>になってサーバーが起動します。</p>
<h3>手順2 - コンソールを開く</h3>
<p>追加したサーバーのネームタグ部分をクリックすると、サーバーの操作が可能になります。画面中央上部に<code>コンソール</code>ボタンがあるのでクリックすると新しくウィンドウが立ち上がり、サーバーのコンソール画面が表示されてキーボードからコマンドを入力できるようになります。</p>
<p>先ほどの手順でrootパスワードを設定しました。今回のライブデモではroot
ユーザで作業を行います。rootユーザでログインを行うため、ユーザ名の<code>root</code>と入力して<code>Enter</code>キーを押します。</p>
<div class="highlight"><pre><span></span><code><span class="go">MIRACLE LINUX 8.4 (Peony)</span>
<span class="go">Kernel 4.18.0-348.12.2.el8_5.x86_64 on an x86_64</span>

<span class="go">xxx-xxx-xxx-xxx login: root</span>
</code></pre></div>

<p>次の行に移り、パスワードを求められるので先ほど設定したパスワードを入力します。パスワードの入力についてはキーボードで押したボタンが画面上に表示されませんがそのまま入力して最後に<code>Enter</code>キーを押してください。</p>
<div class="highlight"><pre><span></span><code><span class="go">Password: </span>
</code></pre></div>

<p>ログインに成功すると、一番最後の行がコマンドを受け付ける状態になります。</p>
<div class="highlight"><pre><span></span><code><span class="gp">[root@xxx-xxx-xxx-xxx ~]#</span>
</code></pre></div>

<p><strong>これ以降、コマンドを打つ際に上記の表記を省略して<code>#</code>だけ行頭に表記しておきます。<code>#</code>より後ろのコマンドを打って、<code>Enter</code>キーを押すことでコマンドを実行することを繰り返す流れになります。行頭に<code>#</code>が無い行はコマンドの実行結果として表示される出力です。</strong></p>
<h3>手順3 - JAVAのインストール</h3>
<p>マインクラフトサーバの本体を動かすために、JAVAのランタイムというものが必要です。下記のコマンドでインストール可能です。
それなりに大きいファイルのダウンロードがあるので終了まで数分かかるかもしれません。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> dnf -y install java-latest-openjdk-headless
</code></pre></div>

<p><strong>NOTE:</strong> JAVAのバージョンは複数ありますが、Minecraft1.17以降はJAVAのバージョン16以降が必要なようです。MLでは<code>java-latest-openjdkほにゃらら</code>がバージョン16になります。因みに<code>java-11-openjdkほにゃらら</code>だとバージョン11がインストールされます。</p>
<h3>手順4 - マインクラフトサーバの本体をダウンロード</h3>
<p>まずはマインクラフトサーバのファイルを置くディレクトリを作成します。そして作業ディレクトリを作成したディレクトリに変更します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> mkdir minecraft-server
<span class="gp">#</span> <span class="nb">cd</span> minecraft-server
</code></pre></div>

<p>マインクラフトサーバのファイルをダウンロードします。今回はバージョン 1.18.2 です。下記のようなコマンドは長くキーボードで全て入力するのは大変ですので、このコマンドをコピーしてコンソール上部の<code>テキスト送信</code>をクリックして貼り付け、<code>送信</code>ボタンをクリックします。</p>
<p><img alt="テキストを張り付ける方法" src="./images/conoha-mc-dl.jpg"></p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> wget https://launcher.mojang.com/v1/objects/c8f83c5655308435b3dcf03c06d9fe8740a77469/server.jar
</code></pre></div>

<p>そしてEnterキーを押して実行します。以降もコマンドについては同じ手順でコピー&amp;ペーストを繰り返すととても楽です。</p>
<h3>手順5 - サーバの初期設定</h3>
<p>マインクラフトサーバに使用メモリなど指定して実行したいので、そのためのスクリプトを作成します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> <span class="nb">echo</span> -e <span class="s1">&#39;#!&#39;</span><span class="s2">&quot;/usr/bin/bash\njava -Xmx3072M -Xms1024M -jar server.jar nogui&quot;</span> &gt; start.sh
</code></pre></div>

<p>この設定についてはConoHaの<a href="https://www.conoha.jp/vps/media/mine-semi/memory/">マイクラゼミ</a>に解説があります。</p>
<p>start.shファイルが作成されていると思います。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> ls
<span class="go">server.jar start.sh</span>
</code></pre></div>

<p>start.shはそのままでは実行できません。実行権限を付与しましょう。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> chmod +x start.sh
</code></pre></div>

<p>とりあえず一度起動してみましょう。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> ./start.sh
<span class="go">[00:00:00] [main/ERROR]: Failed to load properties from file: server.properties</span>
<span class="go">[00:00:00] [main/WARN]: Failed to load eula.txt</span>
<span class="go">[00:00:00] [main/INFO]: You need to agree to the EULA in order to run the server. Go to eula.txt for more info.</span>
</code></pre></div>

<p>何やらメッセージが表示されます。それぞれの行で、<code>server.properties</code>ファイルが見当たらない、<code>eula.txt</code>がロードできない、EULAに同意しないといけないとなっています。</p>
<p>一旦今のファイル一覧を見てみましょう。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> ls
<span class="go">eula.txt logs server.jar server.properties start.sh</span>
</code></pre></div>

<p>ファイルが増えています。EULAに同意するため下記のコマンドを実行します。</p>
<div class="highlight"><pre><span></span><code><span class="go">sed -i &#39;s/false/true/g&#39; eula.txt</span>
</code></pre></div>

<p>サーバのポートがデフォルトだとtcpの25565番ですが、ConoHaの接続許可ポートを指定するにはAPI操作等が必要になってきます。ですので、簡単に選べる代表的なポートを拝借して5432番ポートを利用するように設定変更します。5432番は元々PostgreSQL用ですが、マインクラフトサーバを立てるにあたり同じサーバでPostgreSQLを動かす事はほとんどないと思うので影響は無いと考えていいと思います。</p>
<div class="highlight"><pre><span></span><code><span class="go">sed -i &#39;s/25565/5432/g&#39; server.properties</span>
</code></pre></div>

<p>確認は下記のコマンドで可能です。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> grep <span class="m">5432</span> server.properties
<span class="go">server-port=5432</span>
<span class="go">query.port=5432</span>
</code></pre></div>

<h3>手順6 - ファイヤウォールの設定</h3>
<p>MIRACLE LINUXに機能としてあるファイヤウォールを設定します。初期状態では、マインクラフトサーバで設定した<code>tcp</code>の<code>5432</code>ポートへの接続は閉じられていますので、接続を受け付けるように設定します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> firewall-cmd --add-port<span class="o">=</span><span class="m">5432</span>/tcp
<span class="go">success</span>
</code></pre></div>

<p>追加されたか確認しましょう。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> firewall-cmd --list-all
<span class="go">public (active)</span>
<span class="go">  target: default</span>
<span class="go">  icmp-block-inversion: no</span>
<span class="go">  interfaces: eth0</span>
<span class="go">  sources:</span>
<span class="go">  services: cockpit dhcpv6-client ssh</span>
<span class="go">  ports: 5432/tcp</span>
<span class="go">  protocols:</span>
<span class="go">  masquerade: no</span>
<span class="go">  forward-ports:</span>
<span class="go">  source-ports:</span>
<span class="go">  icmp-blocks:</span>
<span class="go">  rich rules:</span>
</code></pre></div>

<p><code>ports</code>行に追加されているのが確認できます。この設定は再起動すると消えてしまうので、永続的に適用するために下記のコマンドを実行しましょう。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> firewall-cmd --runtime-to-permanent
<span class="go">success</span>
</code></pre></div>

<p><code>success</code>と表示がされればOKです。</p>
<h3>手順7 - サーバの起動</h3>
<p>ついにマインクラフトサーバを起動します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> ./start.sh
</code></pre></div>

<p>マップデータの初期化などが行われるので、数分待つことになると思います。
最後に<code>Done (xx.xxs)! For help, type "help"</code>と表示されたらサーバにログインが可能です。</p>
<h3>手順8 - ゲームの起動と接続</h3>
<p>マインクラフト(バージョン 1.18.2)を起動し、<code>マルチプレイ</code>から<code>サーバーを追加</code>をクリックします。<code>サーバー名</code>はわかりやすい値で好きなように設定し、<code>サーバーアドレス</code>には<code>ConoHaのIPv4のIPアドレス</code>:5432を入力し、完了をクリックします。</p>
<p><strong>NOTE:画像は古いバージョンですが1.18.2も同じ画面です。</strong></p>
<p><img alt="サーバーの追加" src="./images/mc-add-serv.jpg"></p>
<p><img alt="ConoHaのIPアドレス" src="./images/conoha-serv-ip.jpg"></p>
<p><strong>NOTE:</strong> IPアドレスとポート番号の5432の間は<code>コロン</code>という記号で、<code>:</code>です。日本語のキーボードを使っている場合は<code>け</code>の位置です。</p>
<p>追加されたサーバーを選び、<code>サーバーに接続</code>をクリックするとゲームを開始できます。</p>
<p><img alt="サーバーログイン後" src="./images/mc-login.jpg"></p>
<p>コンソール画面を見ると、ログインしたことがわかるログが表示されています。</p>
<p><img alt="ログインがわかるコンソール" src="./images/conoha-mc-log.jpg"></p>
<p>以上で完了です。</p>
<h2>おまけ</h2>
<p>サイバートラスト株式会社さんがMIRACLE LINUXロゴがイメージされたマップデータとみらくるちゃんのスキンデータを公開してくれました！
詳細は<a href="https://www.miraclelinux.com/tech-blog/minecraft">Minecraft用みらくるちゃんスキンとmapを公開! / みらくるブログ</a>をご覧ください。</p>
<h3>手順9 - 提供マップデータのマルチサーバへの適用</h3>
<p>起動中のサーバのコンソールで<code>/stop</code>と入力して<code>Enter</code>キーを押してください。
サーバの状態が保存され終了し、コマンドを入力するシェルに戻ってきます。</p>
<div class="highlight"><pre><span></span><code><span class="go">/stop</span>
</code></pre></div>

<p>先ほどのサイトから辿れるGithubからデータをダウンロードします。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> wget https://github.com/miraclelinux/minecraft-miraclelinux-map/archive/refs/heads/main.zip
</code></pre></div>

<p>zip形式で圧縮されているので解凍します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> unzip main.zip
</code></pre></div>

<p>このデータにはスキンなども入っているので、必要なマップデータのみをマインクラフトサーバの実行フォルダ内に移動します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> mv minecraft-miraclelinux-map-main/saves/MIRACLE<span class="se">\ </span>LINUX<span class="se">\ </span>MEETUP/ ./
</code></pre></div>

<p>マップデータ名は<code>server.properties</code>ファイルの<code>level-name</code>行に設定されています。
初期値は<code>world</code>で同名のフォルダ以下にワールドデータがありますが、配布データは<code>MIRACLE LINUX MEETUP</code>ですので、サーバの設定ファイルを書き換えて配布データを読み込むように設定します。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> sed -i <span class="s1">&#39;s/=world/=MIRACLE LINUX MEETUP/g&#39;</span> server.properties
</code></pre></div>

<p>確認すると<code>level-name</code>行が書き変わっていると思います。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> grep MIRACLE server.properties
<span class="go">level-name=MIRACLE LINUX MEETUP</span>
</code></pre></div>

<p>サーバを起動してクライアントからログインしてみましょう。マップデータが読み込まれ、クライアントからログインを行うとロゴが見えると思います。</p>
<div class="highlight"><pre><span></span><code><span class="gp">#</span> ./start.sh
</code></pre></div>
            </div>
            <div class="post_list">
                <span>By </span>
                <a href="./author/akio-tomita.html">@Akio Tomita</a>
                <span> in </span>
                <span class="post_category"><a href="./category/miracle-linux.html" rel="bookmark"
                                               title="Permalink to MIRACLE LINUX">[ MIRACLE LINUX ]</a></span>
                <span class="post_date">Mon 23 May 2022</span>
                <div><span>Tags : </span>
                </div>

                <div class="entry-social">
                    <span class="twitter"><a target="_blank" rel="nofollow"
                                             onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;"
                                             title="Twitter"
                                             href="https://twitter.com/share?url=./miracle-linux-tips-minecraft-server-conoha-vps.html&text=ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版&via="><img
                            src="./theme/images/icons/twitter-s.png"></a></span>

                    <span class="gplus"><a target="_blank" title="Google +"
                                           href="https://plus.google.com/share?url=./miracle-linux-tips-minecraft-server-conoha-vps.html&hl=fr"
                                           rel="nofollow"
                                           onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="./theme/images/icons/google-s.png"></a></span>

                    <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow"
                                              onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;"
                                              href="https://www.facebook.com/sharer.php?u=./miracle-linux-tips-minecraft-server-conoha-vps.html&t=ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版"><img
                            src="./theme/images/icons/facebook-s.png"></a></span>

                    <a target="_blank" title="Linkedin"
                       href="https://www.linkedin.com/shareArticle?mini=true&url=./miracle-linux-tips-minecraft-server-conoha-vps.html&title=ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版"
                       rel="nofollow"
                       onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;"><img
                            src="./theme/images/icons/linkedin-s.png"></a>

                    <span class="mail"><a
                            href="mailto:?subject=ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版&amp;body=Viens découvrir un article à propos de [ConoHaに導入したMIRACLE LINUX 8.4でマイクラサーバ(JAVA版 1.18.2)を建てる MIRACLE LINUX Meetup!!版] sur le site de Akio Tomita. ./miracle-linux-tips-minecraft-server-conoha-vps.html"
                            title="Share by Email" target="_blank"><img
                            src="./theme/images/icons/mail-s.png"></a></span>
                </div>
            </div>
        </article>
    </section>
</article>

<!-- Footer -->
    <footer>
        <p>
            Blog powered by <a href="http://getpelican.com/">Pelican</a>,
            which takes great advantage of <a href="http://python.org">Python</a>.
            Theme <a href="https://github.com/parbhat/pelican-blue">Pelican-Blue</a> by <a
                href="https://parbhatpuri.com/">@parbhat</a>.
        </p>
    </footer>


</body>
</html>